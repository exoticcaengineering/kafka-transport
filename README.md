
<svg width="184" height="32" viewBox="0 0 184 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M96.6884 1.78015C96.6884 3.4969 98.081 4.88951 99.7977 4.88951C101.514 4.88951 102.909 3.4969 102.909 1.78015H96.6884Z" fill="#121212"/>
<path d="M44.2495 19.0604L53.0956 31.5722H46.9537L41.0883 22.8172L35.2213 31.5722H29.0795L37.8796 19.0145L29.0795 6.36487H35.1762L41.0883 15.256L47.0005 6.36487H53.0956L44.2495 19.0604Z" fill="#121212"/>
<path d="M102.388 6.36414H97.2098V31.5715H102.388V6.36414Z" fill="#121212"/>
<path d="M104.946 18.8769C104.946 11.4527 109.667 6.13617 116.862 6.13617C124.562 6.13617 128.044 11.04 128.502 15.3473H123.828C123.415 12.6439 120.712 10.4435 117.274 10.4435C112.737 10.4435 110.079 13.7893 110.079 18.876C110.079 23.9628 112.782 27.4013 117.32 27.4013C120.665 27.4013 123.187 25.0638 123.828 22.4056H128.456C127.769 26.7589 124.607 31.8464 116.862 31.8464C109.666 31.8464 104.945 26.347 104.945 18.876" fill="#121212"/>
<path d="M130.093 18.8769C130.093 11.4527 134.814 6.13617 142.009 6.13617C149.708 6.13617 153.191 11.04 153.65 15.3473H148.975C148.563 12.6439 145.859 10.4435 142.423 10.4435C137.885 10.4435 135.226 13.7893 135.226 18.876C135.226 23.9628 137.93 27.4013 142.468 27.4013C145.813 27.4013 148.335 25.0638 148.975 22.4056H153.604C152.917 26.7589 149.754 31.8464 142.009 31.8464C134.813 31.8464 130.093 26.347 130.093 18.876" fill="#121212"/>
<path d="M52.6184 18.8875C52.6184 11.5678 57.8079 5.77594 65.2664 5.77594C72.7248 5.77594 77.9143 11.5686 77.9143 18.8875C77.9143 26.2065 72.7257 31.9992 65.2664 31.9992C57.8071 31.9992 52.6184 26.1614 52.6184 18.8875ZM72.6797 18.8875C72.6797 14.1617 69.7149 10.455 65.2664 10.455C60.8179 10.455 57.853 14.1617 57.853 18.8875C57.853 23.6134 60.7728 27.2733 65.2664 27.2733C69.76 27.2733 72.6797 23.5666 72.6797 18.8875Z" fill="#121212"/>
<path d="M87.0648 0H82.1159V4.95977C82.1159 5.40671 81.7525 5.76844 81.3072 5.76844H78.0366V9.96215H82.1577V25.3402C82.1493 28.9107 85.0348 31.812 88.6036 31.8262L93.6018 31.8471V27.2959H88.6654C87.7724 27.2959 87.0472 26.5724 87.0472 25.6777V9.96298H92.3596V5.76927H87.0656V0H87.0648Z" fill="#121212"/>
<path d="M30.1972 18.8767C30.1972 11.2228 25.8423 6.18201 18.7848 6.18201C11.7273 6.18201 7.77758 10.6247 7.00316 16.815H6.66566C5.11098 16.815 3.84618 15.5493 3.84618 13.9955H0C0 17.6704 2.99073 20.6603 6.66566 20.6603H6.95888C7.6247 27.062 12.0774 31.8004 18.7848 31.8004C25.798 31.8472 28.9591 27.4471 29.5548 23.8257H25.2466C24.2834 26.3009 21.8549 27.722 18.7389 27.722C15.4399 27.6769 12.1392 25.2016 11.8635 20.5718H30.1045C30.1964 19.9761 30.1964 19.3805 30.1964 18.8767M11.9554 16.8141C12.5511 12.9646 14.7515 10.3064 18.738 10.3064C22.7246 10.3064 24.8331 12.8727 25.2909 16.8141H11.9546H11.9554Z" fill="#121212"/>
<path d="M183.09 12.9443H179.243C179.243 14.499 177.979 15.7638 176.424 15.7638H176.23V15.3486C176.23 9.25352 172.381 6.0907 166.286 6.0907C159.319 6.0907 156.341 10.3997 155.973 14.8908H160.465C160.786 11.8199 163.077 10.2159 166.148 10.2159C169.402 10.2159 171.464 11.7748 171.464 15.2567V15.7546L165.69 16.3461C158.823 16.9735 155.333 19.9316 155.333 24.4227C155.333 28.9138 158.861 31.8486 163.673 31.8486C167.248 31.8486 170.549 30.3365 171.923 28.365C172.656 30.7484 174.581 31.2981 176.644 31.5278C177.194 31.5729 177.698 31.5729 178.203 31.5729V27.5855C177.056 27.6307 176.278 26.8521 176.278 24.2865C176.278 23.5322 176.26 21.726 176.248 19.6116H176.425C180.101 19.6116 183.09 16.6218 183.09 12.946M171.464 23.462C170.777 25.7995 167.89 27.8153 164.682 27.8153C162.482 27.8153 160.373 26.5329 160.373 24.2406C160.373 22.0878 161.977 20.6275 166.469 20.0703L171.464 19.6125V23.462Z" fill="#121212"/>
</svg>

![exoticcaLogoBlack (1)](https://github.com/user-attachments/assets/9fd3d1da-34ea-460c-8e7d-3453acb49e89)

# Exoticca Kafka Transport Bundle

## What is it for?
The **Exoticca Kafka Messenger Bundle** extends Symfony Messenger's capability to use Kafka as a transport, facilitating integration with event-driven architectures.

---

## Motivation
Existing solutions to integrate Kafka with Symfony Messenger present limitations when working with complex event architectures. This bundle addresses these issues by offering greater flexibility and traceability in event management.

---

## Features
- **Generic Serialization and Deserialization:** Manages the entire message flow using Symfony's serializer.
- **Message Production and Consumption:** Supports both single-topic and multi-topic scenarios, enabling complex event flows.
- **Selective Message Consumption:** Allows consuming only relevant messages for the application while efficiently discarding the rest.
- **Enhanced Traceability:** Supports defining custom headers generically for any message.
- **Optional Schema Validation:** Integrates with *Schema Registry* using Apache Avro, allowing selective validation by transport.
- **Apache Union Schema Compatibility:** Thanks to enhancements on the reference library [avro-php](https://gitlab.com/Jaumo/avro-php).

---

## Installation
```bash
composer require exoticca/kafka-transport
```

Add the bundle to the list of bundles in `config/bundles.php`:
```php
Exoticca\KafkaMessenger\ExoticcaKafkaBundle::class => ['all' => true],
```

---

## Basic Configuration
Create a configuration file at `config/packages/exoticca_kafka_messenger.yaml` with the minimal setup:

```yaml
exoticca_kafka_messenger:
  identifier:
    staticMethod: 'eventName'
  consumer:
    validate_schema: false
    config:
      group.id: 'group-id'
  producer:
    validate_schema: false
    config: {}
```

### Explanation
- `staticMethod`: A static method that returns a string, required in all messages to enable complex Kafka routing.
- `validate_schema`: By default, schema validation against *Schema Registry* is disabled.
- `config`: Allows adding specific Kafka configuration. See the [official documentation](https://github.com/confluentinc/librdkafka/blob/master/CONFIGURATION.md) for more details.

---

## Transport Configuration
Example of transport configuration in `messenger.yaml`:

```yaml
kafka:
  dsn: '%env(KAFKA_EVENTS_MESSENGER_TRANSPORT_DSN)%'
  options:
    topics: [ 'test_topic' ]
    consumer:
      routing:
        - name: 'test_event'
          class: 'Exoticca\Domain\Event\TestEvent'
      config:
        group.id: 'group-id'

routing:
  'Exoticca\RMS\Domain\Event\TestEvent': kafka
```

### Execution
To consume the message:
```bash
bin/console messenger:consume kafka -vvv
```
The bundle will automatically deserialize the message.

---

## Advanced Usage
### Consume Multiple Message Types from a Single Topic
If a topic contains multiple event types (e.g., `CustomerRegistered`, `CustomerUpdated`, `CustomerDeleted`), you can configure the bundle to consume only the relevant messages and automatically commit the rest.

### Consume from Multiple Topics in a Single Transport
Example:

```yaml
complex_transport:
  dsn: '%env(KAFKA_EVENTS_MESSENGER_TRANSPORT_DSN)%'
  options:
    topics: ['customers', 'orders']
    consumer:
      config:
        group.id: 'group-id'
      routing:
        - name: 'customer_created'
          class: 'Exoticca\Domain\Customer\Event\CustomerCreated'
        - name: 'order_created'
          class: 'Exoticca\Domain\Order\Event\OrderCreated'
```

---

## Acknowledgments
Special thanks to the [avro-php](https://gitlab.com/Jaumo/avro-php) library for facilitating integration with Apache Avro.

